import { Button } from '@/components/atoms';
import { Form } from '@/components/organisms';
import { loginForm } from '@/utils/constants/forms';
import { useRouter } from 'next/navigation';
import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { User } from '@supabase/supabase-js';
import { NextPage } from 'next';
import { supabase } from '@/supabase';

const SignIn: NextPage = () => {
  const [user, setUser] = useState<User | null>();
  const router = useRouter();

  if (user) {
    router.push('/dashboard');
  }

  const form = useForm();

  const handleRegister = form.handleSubmit(async (data: { email: string }) => {
    const { data: response, error } = await supabase.auth.signInWithOtp({
      email: data.email,
      options: {
        emailRedirectTo: `${
          process.env.NEXT_PUBLIC_URL || 'http://localhost:3000'
        }/dashboard`,
      },
    });
    router.push('/validate');
  });

  return (
    <div className="flex justify-center items-center w-full h-screen">
      <div className="flex flex-col sm:w-96 p-4 rounded-xl">
        <div className="flex justify-center">
          <svg
            width="240"
            height="80"
            viewBox="0 0 1433 329"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M573.974 99.0506C550.743 75.1576 519.854 62 487 62C454.146 62 423.257 75.1576 400.026 99.0506C376.794 122.943 364 154.711 364 188.5C364 222.289 376.794 254.056 400.026 277.949C423.257 301.841 454.146 315 487 315C519.854 315 550.743 301.841 573.974 277.949C597.206 254.056 610 222.289 610 188.5C610 154.711 597.206 122.943 573.974 99.0506ZM490.041 104.955L525.976 94.1638L561.988 121.169L563.11 159.53L527.543 175.625L490.041 147.602V104.955ZM443.657 181.279L457.786 226.002L434.468 251.395L398.34 233.779L388.65 195.393L408.536 165.386L443.657 181.279ZM410.818 160.022L411.979 120.349L447.894 94.125L484.347 105.07V126.192V147.313L446.021 175.951L410.818 160.022ZM460.201 231.902H514.351L514.691 230.827L537.014 255.136L518.547 285.434H455.838L437.967 256.114L460.201 231.902ZM540.95 250.892L516.696 224.481L530.538 180.667L565.154 165.003L585.707 196.018L575.402 234.093L540.95 250.892ZM582.642 122.849L564.216 115.591L527.989 88.4251L516.841 74.245C544.071 81.7738 567.339 99.3457 582.642 122.849ZM457.16 74.2438L446.214 88.1687L407.406 116.505L391.378 122.818C406.681 99.3294 429.942 81.7702 457.16 74.2438ZM372.193 181.285L383.863 199.736L393.421 237.599L392.582 255.986C379.598 236.832 371.972 213.566 371.972 188.5C371.972 186.076 372.052 183.673 372.193 181.285ZM438.097 295.561L459.407 291.291H514.978L536.016 295.507C521.138 302.744 504.521 306.802 487 306.802C469.522 306.801 452.947 302.765 438.097 295.561ZM581.779 255.453L580.878 235.698L591.008 198.267L601.803 181.202C601.946 183.617 602.028 186.049 602.028 188.5C602.028 213.334 594.543 236.401 581.779 255.453Z"
              fill="#C53D02"
            />
            <path
              d="M24.96 68H35.52C60.6933 68 80.32 74.72 94.4 88.16C108.48 101.387 115.52 119.2 115.52 141.6C115.52 157.173 112.107 171.04 105.28 183.2C98.4533 195.147 89.1733 204.427 77.44 211.04C65.7067 217.44 52.5867 220.64 38.08 220.64H35.52V308H24.96V68ZM38.72 211.36C58.1333 211.36 74.0267 205.387 86.4 193.44C98.7733 181.28 104.96 164.213 104.96 142.24C104.96 121.333 99.0933 105.333 87.36 94.24C75.84 82.9333 59.4133 77.28 38.08 77.28H35.52V211.36H38.72ZM152.155 68H238.235V77.28H162.715V207.84H225.755V217.12H162.715V298.72H238.235V308H152.155V68ZM271.843 68H282.403V298.72H356.643V308H271.843V68ZM487.34 314.4C464.94 314.4 444.14 308.533 424.94 296.8C405.74 285.067 390.487 269.493 379.18 250.08C368.087 230.453 362.54 209.44 362.54 187.04C362.54 164.853 368.193 144.16 379.5 124.96C390.807 105.547 406.06 90.1867 425.26 78.88C444.46 67.36 465.26 61.6 487.66 61.6C510.273 61.6 531.073 67.2533 550.06 78.56C569.047 89.8667 584.087 105.227 595.18 124.64C606.487 143.84 612.14 164.64 612.14 187.04C612.14 210.08 606.487 231.413 595.18 251.04C584.087 270.453 568.94 285.92 549.74 297.44C530.753 308.747 509.953 314.4 487.34 314.4ZM487.34 305.12C507.82 305.12 526.807 299.893 544.3 289.44C561.793 278.773 575.66 264.48 585.9 246.56C596.353 228.427 601.58 208.8 601.58 187.68C601.58 166.773 596.46 147.36 586.22 129.44C575.98 111.52 562.113 97.3333 544.62 86.88C527.127 76.2133 508.14 70.88 487.66 70.88C466.967 70.88 447.873 76.2133 430.38 86.88C412.887 97.3333 398.913 111.52 388.46 129.44C378.22 147.36 373.1 166.773 373.1 187.68C373.1 208.8 378.22 228.427 388.46 246.56C398.913 264.48 412.887 278.773 430.38 289.44C447.873 299.893 466.86 305.12 487.34 305.12ZM666.768 77.28H611.408V68H732.048V77.28H677.328V308H666.768V77.28ZM764.03 68H850.11V77.28H774.59V207.84H837.63V217.12H774.59V298.72H850.11V308H764.03V68ZM883.718 68H897.478C922.438 68 941.638 74.6133 955.078 87.84C968.731 101.067 975.558 119.947 975.558 144.48C975.558 158.56 972.144 171.467 965.318 183.2C958.704 194.933 949.638 204.213 938.118 211.04C926.598 217.653 913.904 220.96 900.038 220.96H897.798L980.358 308H966.598L893.958 231.84V308H883.718V68ZM899.718 211.68C911.878 211.68 922.971 208.693 932.998 202.72C943.024 196.747 950.918 188.747 956.678 178.72C962.438 168.48 965.318 157.173 965.318 144.8C965.318 123.253 959.451 106.613 947.718 94.88C936.198 83.1467 919.664 77.28 898.118 77.28H893.958V211.68H899.718ZM1240.55 308H1229.35L1183.91 216.48H1056.55L1012.07 308H1000.87L1120.55 62.24L1240.55 308ZM1180.07 207.2L1119.91 85.28L1061.03 207.2H1180.07ZM1326.46 312.48C1299.79 312.48 1279.1 301.493 1264.38 279.52V262.24C1270.14 275.04 1278.46 285.067 1289.34 292.32C1300.43 299.573 1313.66 303.2 1329.02 303.2C1339.68 303.2 1349.5 300.853 1358.46 296.16C1367.63 291.467 1374.88 284.853 1380.22 276.32C1385.55 267.787 1388.22 257.973 1388.22 246.88C1388.22 236.853 1386.51 228.213 1383.1 220.96C1379.68 213.707 1374.03 206.773 1366.14 200.16C1358.24 193.333 1346.83 185.333 1331.9 176.16L1321.66 169.76C1312.27 164 1304.7 158.88 1298.94 154.4C1293.18 149.92 1288.16 144.693 1283.9 138.72C1278.35 130.4 1275.58 120.8 1275.58 109.92C1275.58 95.4133 1280.27 84.1067 1289.66 76C1299.04 67.8933 1310.99 63.84 1325.5 63.84C1345.12 63.84 1360.7 71.0933 1372.22 85.6V101.92C1367.31 92.96 1360.59 85.92 1352.06 80.8C1343.52 75.68 1334.14 73.12 1323.9 73.12C1313.23 73.12 1304.27 76.4267 1297.02 83.04C1289.76 89.6533 1286.14 98.5067 1286.14 109.6C1286.14 120.48 1289.44 129.867 1296.06 137.76C1302.88 145.44 1314.3 153.867 1330.3 163.04C1349.92 174.56 1365.18 185.013 1376.06 194.4C1383.74 201.44 1389.28 209.227 1392.7 217.76C1396.32 226.293 1398.14 235.787 1398.14 246.24C1398.14 259.467 1395.04 271.093 1388.86 281.12C1382.67 291.147 1374.14 298.933 1363.26 304.48C1352.38 309.813 1340.11 312.48 1326.46 312.48Z"
              fill="#C53D02"
            />
          </svg>
        </div>
        <div className="my-4">
          <Form formInputs={loginForm} numberOfColumns={1} {...form} />
        </div>
        <Button text="Ingresar" onClick={handleRegister} />
      </div>
    </div>
  );
};

export default SignIn;
